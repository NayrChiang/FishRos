# Chapter 2: ROS 2 Packages and Workspaces

## Overview

This chapter covers the fundamental concepts of ROS 2 workspaces and packages. You'll learn how to create and structure ROS 2 packages for both C++ and Python, understand the build system (colcon), and set up a proper workspace environment.

## Key Concepts

### ROS 2 Workspace Structure

A ROS 2 workspace is a directory where you organize, build, and install ROS 2 packages. The standard workspace structure is:

```
workspace_name/
├── src/              # Source code (packages go here)
├── build/            # Build artifacts (generated by colcon)
├── install/          # Installation directory (generated by colcon)
└── log/              # Build logs (generated by colcon)
```

### ROS 2 Packages

A package is the basic unit of organization in ROS 2. It contains:
- **Source code** (C++ or Python)
- **Package metadata** (`package.xml`)
- **Build configuration** (`CMakeLists.txt` for C++, `setup.py` for Python)
- **Resource files** (launch files, configs, etc.)

### Package Types

**C++ Packages:**
- Use `ament_cmake` as build tool
- Require `CMakeLists.txt` for building
- Executables are built from C++ source files

**Python Packages:**
- Use `ament_python` as build tool
- Require `setup.py` for building
- Entry points defined in `setup.py` for executable scripts

## Code Examples

### Example 1: C++ Package Structure

**package.xml:**
```xml
<?xml version="1.0"?>
<package format="3">
  <name>demo_cpp_pkg</name>
  <version>0.0.0</version>
  <description>Package description</description>
  <maintainer email="email@example.com">Your Name</maintainer>
  <license>Apache-2.0</license>

  <buildtool_depend>ament_cmake</buildtool_depend>
  <depend>rclcpp</depend>

  <export>
    <build_type>ament_cmake</build_type>
  </export>
</package>
```

**CMakeLists.txt:**
```cmake
cmake_minimum_required(VERSION 3.8)
project(demo_cpp_pkg)

find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)

add_executable(cpp_node src/cpp_node.cpp)
ament_target_dependencies(cpp_node rclcpp)

install(TARGETS cpp_node DESTINATION lib/${PROJECT_NAME})

ament_package()
```

**Key Points:**
- `find_package()` locates ROS 2 dependencies
- `ament_target_dependencies()` links dependencies to targets
- `install()` specifies where executables are installed
- `ament_package()` finalizes the package configuration

### Example 2: Python Package Structure

**package.xml:**
```xml
<?xml version="1.0"?>
<package format="3">
  <name>demo_python_pkg</name>
  <version>0.0.0</version>
  <description>Package description</description>
  <maintainer email="email@example.com">Your Name</maintainer>
  <license>Apache-2.0</license>

  <buildtool_depend>ament_cmake</buildtool_depend>
  <buildtool_depend>ament_python</buildtool_depend>
  <exec_depend>rclpy</exec_depend>

  <export>
    <build_type>ament_python</build_type>
  </export>
</package>
```

**setup.py:**
```python
from setuptools import find_packages, setup

package_name = 'demo_python_pkg'

setup(
    name=package_name,
    version='0.0.0',
    packages=find_packages(exclude=['test']),
    data_files=[
        ('share/ament_index/resource_index/packages',
            ['resource/' + package_name]),
        ('share/' + package_name, ['package.xml']),
    ],
    install_requires=['setuptools'],
    zip_safe=True,
    entry_points={
        'console_scripts': [
            'python_node = demo_python_pkg.python_node:main',
        ],
    },
)
```

**Key Points:**
- `entry_points` defines executable commands
- Format: `'command_name = package.module:function'`
- `data_files` installs package resources

### Example 3: Building with Colcon

```bash
# Navigate to workspace root
cd ~/workspace_name

# Build all packages
colcon build

# Build specific package
colcon build --packages-select package_name

# Build with symlink install (faster development)
colcon build --symlink-install

# Source the workspace
source install/setup.bash
```

## Key Takeaways

1. **Workspace Organization**: Always keep source code in `src/` directory. Build artifacts are generated automatically.

2. **Package Dependencies**: Declare dependencies in `package.xml`:
   - `<buildtool_depend>` - Build-time dependencies
   - `<depend>` - Both build and runtime dependencies
   - `<exec_depend>` - Runtime-only dependencies
   - `<test_depend>` - Testing dependencies

3. **Building Process**: 
   - `colcon build` compiles all packages in `src/`
   - Creates `build/`, `install/`, and `log/` directories
   - Installs packages to `install/` directory

4. **Sourcing**: After building, source `install/setup.bash` to make packages available in your environment.

5. **Package Naming**: Use lowercase with underscores (snake_case). Package name should match directory name.

6. **C++ vs Python**: 
   - C++ packages need `CMakeLists.txt` and use `ament_cmake`
   - Python packages need `setup.py` and use `ament_python`
   - Both need `package.xml`

## Related Topics

- **Chapter 1**: Basic node structure (prerequisite)
- **Chapter 3**: Using packages to create publishers and subscribers
- **Chapter 5**: Launch files for running multiple nodes from packages

## Resources

- [ROS 2 Package Format](https://docs.ros.org/en/humble/Guides/Developing-a-ROS-2-Package.html)
- [Colcon Build Tool](https://colcon.readthedocs.io/)
- [Creating a Package](https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html)
- [Ament CMake Documentation](https://github.com/ament/ament_cmake)

